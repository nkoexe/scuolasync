const FuzzySet=function(i,t,e,o){function h(i,t){if(null===i&&null===t)throw"Trying to compare two null values";var e;return null===i||null===t?0:(e=function(i,t){for(var e,o,n=[],a=0;a<=t.length;a++)for(var s=0;s<=i.length;s++)o=a&&s?i.charAt(s-1)===t.charAt(a-1)?e:Math.min(n[s],n[s-1],e)+1:a+s,e=n[s],n[s]=o;return n.pop()}(i=String(i),t=String(t)),i.length>t.length?1-e/i.length:1-e/t.length)}function y(i,t){for(var e={},o=function(i,t){t=t||2;var e="-"+i.toLowerCase().replace(s,"")+"-",o=t-e.length,n=[];if(0<o)for(var a=0;a<o;++a)e+="-";for(a=0;a<e.length-t+1;++a)n.push(e.slice(a,a+t));return n}(i,t=t||2),n=0;n<o.length;++n)o[n]in e?e[o[n]]+=1:e[o[n]]=1;return e}for(var n={},s=(i=i||[],n.gramSizeLower=e||2,n.gramSizeUpper=o||3,n.useLevenshtein="boolean"!=typeof t||t,n.exactSet={},n.matchDict={},n.items={},/[^a-zA-Z0-9\u00C0-\u00FF\u0621-\u064A\u0660-\u0669, ]+/g),a=(n.get=function(i,t,e){i=this._get(i,e=void 0===e?.33:e);return i||void 0===t?i:t},n._get=function(i,t){for(var e,o=this.gramSizeUpper;o>=this.gramSizeLower;--o)if((e=this.__get(i,o,t))&&0<e.length)return e;return null},n.__get=function(i,t,e){var o,n,a,s,_=this._normalizeStr(i),u={},l=y(_,t),r=this.items[t],d=0;for(o in l)if(n=l[o],d+=Math.pow(n,2),o in this.matchDict)for(v=0;v<this.matchDict[o].length;++v)a=this.matchDict[o][v][0],s=this.matchDict[o][v][1],a in u?u[a]+=n*s:u[a]=n*s;if(function(i){for(var t in i)if(i.hasOwnProperty(t))return;return 1}(u))return null;var c,m=Math.sqrt(d),z=[];for(c in u)z.push([u[c]/(m*r[c][0]),r[c][1]]);function f(i,t){return i[0]<t[0]?1:i[0]>t[0]?-1:0}if(z.sort(f),this.useLevenshtein){for(var g=[],p=Math.min(50,z.length),v=0;v<p;++v)g.push([h(z[v][1],_),z[v][1]]);(z=g).sort(f)}return g=[],z.forEach(function(i){i[0]>=e&&g.push([i[0],this.exactSet[i[1]]])}.bind(this)),g},n.add=function(i){if(this._normalizeStr(i)in this.exactSet)return!1;for(var t=this.gramSizeLower;t<this.gramSizeUpper+1;++t)this._add(i,t)},n._add=function(i,t){var e,o,n=this._normalizeStr(i),a=this.items[t]||[],s=a.length,_=(a.push(0),y(n,t)),u=0;for(e in _)o=_[e],u+=Math.pow(o,2),e in this.matchDict?this.matchDict[e].push([s,o]):this.matchDict[e]=[[s,o]];var l=Math.sqrt(u);a[s]=[l,n],this.items[t]=a,this.exactSet[n]=i},n._normalizeStr=function(i){if("[object String]"!==Object.prototype.toString.call(i))throw"Must use a string as argument to FuzzySet functions";return i.toLowerCase()},n.length=function(){var i,t=0;for(i in this.exactSet)this.exactSet.hasOwnProperty(i)&&(t+=1);return t},n.isEmpty=function(){for(var i in this.exactSet)if(this.exactSet.hasOwnProperty(i))return!1;return!0},n.values=function(){var i,t=[];for(i in this.exactSet)this.exactSet.hasOwnProperty(i)&&t.push(this.exactSet[i]);return t},n.gramSizeLower);a<n.gramSizeUpper+1;++a)n.items[a]=[];for(a=0;a<i.length;++a)n.add(i[a]);return n};function compara_ora_inizio(i,t){return null===i.ora_inizio&&null===t.ora_inizio?0:null===i.ora_inizio?1:null===t.ora_inizio?-1:i.ora_inizio.localeCompare(t.ora_inizio)}function compara_ora_predefinita(i,t){return null===i.numero_ora_predefinita&&null===t.numero_ora_predefinita?compara_ora_inizio(i,t):null===i.numero_ora_predefinita?1:null===t.numero_ora_predefinita?-1:"string"==typeof i.numero_ora_predefinita||"string"==typeof t.numero_ora_predefinita?t.numero_ora_predefinita.localeCompare(i.numero_ora_predefinita):t.numero_ora_predefinita-i.numero_ora_predefinita}function compara_data(i,t){return null===i.data&&null===t.data?compara_ora_predefinita(i,t):null===i.data?1:null===t.data?-1:i.data-t.data}function compara_classe(i,t){return null===i.nome_classe&&null===t.nome_classe?0:null===i.nome_classe?1:null===t.nome_classe?-1:t.nome_classe.localeCompare(i.nome_classe)}function compara_aula(i,t){return null===i.numero_aula&&null===t.numero_aula?0:null===i.numero_aula?1:null===t.numero_aula?-1:t.numero_aula.localeCompare(i.numero_aula)}function compara_docente(i,t){return null===i.cognome_docente&&null===t.cognome_docente?0:null===i.cognome_docente?1:null===t.cognome_docente?-1:i.cognome_docente!=t.cognome_docente?t.cognome_docente.localeCompare(i.cognome_docente):i.nome_docente!=t.nome_docente?t.nome_docente.localeCompare(i.nome_docente):0}class Selezione{constructor({id:i,lista:t,callback:e,filtra_lista:o,render:n,select_on_exit:a,select_on_keydown:s,autocomplete:_}){this.id=i.replaceAll("-","_"),this.ui_container=document.getElementById(i),this.ui_input=this.ui_container.getElementsByClassName("selezione-input")[0],this.ui_dropdown=this.ui_container.getElementsByClassName("selezione-dropdown")[0],this.ui_lista=this.ui_dropdown.children[0],this.select_on_exit=null==a||a,this.select_on_keydown=null!=s&&s,this.autocomplete=null!=_&&_,this.lista_elementi,this.lista_visualizzati,t instanceof Array&&this.aggiorna(t),this.current_index=0,this.selected=null,this.already_selected=!1,this.callback=e,this.filtra_lista=i=>i,this.render=i=>i,o&&(this.filtra_lista=o),n&&(this.render=n),this.ui_input.onfocus=i=>{this.already_selected=!1,this.selected=null,this.current_index=-1,this.ui_input.select(),this.ui_dropdown.style.display="block",this.genera_dropdown()},this.ui_input.onblur=i=>{this.autocomplete?""==this.ui_input.value||0==this.lista_visualizzati.length||this.lista_visualizzati==this.lista_elementi.values()?this.seleziona(null):null==this.selected?this.seleziona(this.lista_visualizzati[0]):this.seleziona(this.selected):this.select_on_exit&&!this.already_selected&&this.seleziona(this.ui_input.value),this.ui_dropdown.style.display="none"},this.ui_input.oninput=i=>{this.already_selected=!1,this.selected=null,this.select_on_keydown?this.seleziona(this.ui_input.value):(this.current_index=-1,this.genera_dropdown(),this.ui_lista.scrollTop=0)};let u;this.ui_input.onkeydown=i=>{switch(i.keyCode){case 38:0!=this.lista_visualizzati.length&&(i.preventDefault(),-1!==this.current_index?document.getElementById("lista_"+this.id+this.current_index).classList.remove("lista_current"):this.current_index=0,this.current_index=(this.current_index+this.lista_visualizzati.length-1)%this.lista_visualizzati.length,(u=document.getElementById("lista_"+this.id+this.current_index)).scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}),u.classList.add("lista_current"));break;case 40:0!=this.lista_visualizzati.length&&(i.preventDefault(),-1!==this.current_index&&document.getElementById("lista_"+this.id+this.current_index).classList.remove("lista_current"),this.current_index=(this.current_index+1)%this.lista_visualizzati.length,(u=document.getElementById("lista_"+this.id+this.current_index)).scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}),u.classList.add("lista_current"));break;case 13:i.preventDefault(),-1!==this.current_index?this.seleziona(this.lista_visualizzati[this.current_index]):this.seleziona(this.ui_input.value),this.ui_input.blur();break;case 27:this.seleziona(null),this.ui_input.blur()}}}get valore(){return this.ui_input.value}set valore(i){this.seleziona(i)}seleziona(i){this.already_selected=!0,("string"==typeof i||i instanceof String)&&0!==i.length?(this.ui_input.value=this.render(i),this.selected=i):(this.ui_input.value="",this.selected=null),this.callback&&this.callback(this.selected)}aggiorna(t){t=this.filtra_lista(t),this.lista_elementi=FuzzySet();for(let i=0;i<t.length;i++)this.lista_elementi.add(t[i])}render_lista(){this.ui_lista.innerHTML="";for(let i=0;i<this.lista_visualizzati.length;i++){var t=document.createElement("li");t.id="lista_"+this.id+i,t.innerHTML=`<span>${this.render(this.lista_visualizzati[i])}</span>`,t.onmousedown=()=>{this.seleziona(this.lista_visualizzati[i])},this.ui_lista.appendChild(t)}}genera_dropdown(){if(null==this.lista_elementi)this.ui_dropdown.style.display="none";else{let e=this.ui_input.value.toLowerCase();0==e.length?this.lista_visualizzati=this.lista_elementi.values():(this.lista_visualizzati=this.lista_elementi.values().filter(i=>i.toLowerCase().includes(e)),0<this.lista_visualizzati.length?this.lista_visualizzati=this.lista_visualizzati.sort((i,t)=>i.toLowerCase().indexOf(e)-t.toLowerCase().indexOf(e)):this.lista_visualizzati=this.lista_elementi.get(e,[],.15).map(i=>i[1])),this.render_lista()}}}function prendi_ora(i){return Array.from(i,i=>i.numero)}function prendi_testo(i){return Array.from(i,i=>i.testo)}function prendi_nome(i){return Array.from(i,i=>i.nome)}function prendi_numero(i){return Array.from(i,i=>i.numero)}function prendi_cognome_nome(i){return Array.from(i,i=>i.cognome+" "+i.nome)}const pulsante_logout=document.getElementById("pulsante-logout"),ui_context_menu=document.getElementById("context-menu"),ui_pulsanti_context_menu=document.getElementById("pulsanti-context-menu"),ui_conferma_elimina=document.getElementById("dialog-conferma-elimina"),ui_conferma_elimina_titolo=document.getElementById("dialog-conferma-elimina-titolo"),ui_conferma_elimina_storico_container=document.getElementById("dialog-conferma-elimina-storico-container"),ui_conferma_elimina_storico=document.getElementById("dialog-conferma-elimina-storico"),ui_conferma_elimina_per_reale=document.getElementById("dialog-conferma-elimina-per-reale");function fix_date_to_input(i){return i.getTime()-60*i.getTimezoneOffset()*1e3}function fix_date_from_input(i){return i+60*(new Date).getTimezoneOffset()*1e3}function ui_loading_sostituzioni(){ui_sostituzioni_lista.innerHTML="",ui_sostituzioni_messaggio_informativo.innerHTML="<span>Caricamento...</span>",ui_sostituzioni_messaggio_informativo.style.display="flex"}function ui_refresh_sostituzioni(){ui_loading_sostituzioni(),s_richiedi_sostituzioni(filtri=sostituzioni_filtra_data())}function ui_nascondi_sostituzione(){pubblica_sostituzione(id=parseInt(ui_context_menu.dataset.id),!1),ui_context_menu.closingcallback()}function ui_pubblica_sostituzione(){pubblica_sostituzione(id=parseInt(ui_context_menu.dataset.id),!0),ui_context_menu.closingcallback()}function ui_modifica_sostituzione(){mostra_modifica_sostituzione(id=parseInt(ui_context_menu.dataset.id)),ui_context_menu.closingcallback()}function ui_duplica_sostituzione(){mostra_duplica_sostituzione(id=parseInt(ui_context_menu.dataset.id)),ui_context_menu.closingcallback()}function ui_conferma_elimina_sostituzione(){s_elimina_sostituzione(id=parseInt(ui_context_menu.dataset.id),!1),ui_context_menu.closingcallback()}function ui_modifica_evento(){mostra_modifica_evento(id=parseInt(ui_context_menu.dataset.id)),ui_context_menu.closingcallback()}function ui_duplica_evento(){id=parseInt(ui_context_menu.dataset.id),console.log("Duplica evento: "+id),mostra_duplica_evento(id),ui_context_menu.closingcallback()}function ui_conferma_elimina_evento(){s_elimina_evento(id=parseInt(ui_context_menu.dataset.id)),ui_context_menu.closingcallback()}function ui_modifica_notizia(){mostra_modifica_notizia(id=parseInt(ui_context_menu.dataset.id)),ui_context_menu.closingcallback()}function ui_conferma_elimina_notizia(){s_elimina_notizia(id=parseInt(ui_context_menu.dataset.id)),ui_context_menu.closingcallback()}function ui_elimina(){ui_pulsanti_context_menu.classList.add("hidden"),ui_conferma_elimina.classList.remove("hidden")}function ui_annulla_elimina(){ui_context_menu.closingcallback()}function pulsante(i,t,e){return`<button onclick="${i}()" class="pulsante-context-menu" tabindex="0"><span class="material-symbols-rounded">${t}</span><span>${e}</span></button>`}function mostra_context_menu_sostituzione(i,t){i.preventDefault(),ui_conferma_elimina_titolo.innerHTML="Eliminare Sostituzione?",ui_conferma_elimina_storico_container.classList.remove("hidden"),ui_conferma_elimina_per_reale.onclick=ui_conferma_elimina_sostituzione,ui_pulsanti_context_menu.innerHTML=pulsante("ui_modifica_sostituzione","edit","Modifica")+pulsante("ui_duplica_sostituzione","content_copy","Duplica")+(t.classList.contains("non-pubblicato")?pulsante("ui_pubblica_sostituzione","visibility","Pubblica"):pulsante("ui_nascondi_sostituzione","visibility_off","Nascondi"))+pulsante("ui_elimina","delete","Elimina"),mostra_context_menu(t)}function mostra_context_menu_evento(i,t){i.preventDefault(),ui_conferma_elimina_titolo.innerHTML="Eliminare Evento?",ui_conferma_elimina_storico_container.classList.add("hidden"),ui_conferma_elimina_per_reale.onclick=ui_conferma_elimina_evento,ui_pulsanti_context_menu.innerHTML=pulsante("ui_modifica_evento","edit","Modifica")+pulsante("ui_duplica_evento","content_copy","Duplica")+pulsante("ui_elimina","delete","Elimina"),mostra_context_menu(t)}function mostra_context_menu_notizia(i,t){i.preventDefault(),ui_conferma_elimina_titolo.innerHTML="Eliminare Notizia?",ui_conferma_elimina_storico_container.classList.add("hidden"),ui_conferma_elimina_per_reale.onclick=ui_conferma_elimina_notizia,ui_pulsanti_context_menu.innerHTML=pulsante("ui_modifica_notizia","edit","Modifica")+pulsante("ui_elimina","delete","Elimina"),mostra_context_menu(t)}function mostra_context_menu(i){i.focus();var t=i.dataset.id;i.classList.add("context-menu-active"),ui_context_menu.dataset.id=t,ui_context_menu.classList.remove("hidden"),event.clientX+ui_context_menu.offsetWidth>window.innerWidth?ui_context_menu.style.left=window.innerWidth-ui_context_menu.offsetWidth+"px":event.clientX<0?ui_context_menu.style.left="0px":ui_context_menu.style.left=event.clientX+"px",event.clientY+ui_context_menu.offsetHeight>window.innerHeight?ui_context_menu.style.top=window.innerHeight-ui_context_menu.offsetHeight+"px":event.clientY<0?ui_context_menu.style.top="0px":ui_context_menu.style.top=event.clientY+"px",ui_context_menu.focus(),ui_context_menu.closingcallback=()=>{ui_context_menu.classList.add("hidden"),ui_pulsanti_context_menu.classList.remove("hidden"),ui_conferma_elimina.classList.add("hidden"),i.classList.remove("context-menu-active")}}pulsante_logout.onclick=i=>{var t=document.getElementById("fun");t.style.top="-70vh",t.style.right="-70vw",t.style.height="200vh",t.style.width="200vw",i.preventDefault(),setTimeout(()=>{location.href=pulsante_logout.href},210)},ui_context_menu.onblur=i=>{i.relatedTarget&&i.relatedTarget.closest("#context-menu")?ui_context_menu.focus():ui_context_menu.closingcallback()};for(const R0 of document.getElementsByClassName("tooltip")){let i=R0.getBoundingClientRect();i.right>window.innerWidth&&(R0.style.translate="-"+(i.width/2+(i.right-window.innerWidth))+"px 0")}const ui_evento_html_template=`
<li>
<div class="evento {urgente}" data-id={id} tabindex="0">
    <div class="evento-data">
        <span>{data}</span>
    </div>
    <div class="evento-testo">{testo}</div>
</div>
</li>`,ui_eventi_lista=document.getElementById("eventi-lista");function format_date(i,t){var e;return null==i||null==t?"":(e=new Date,i=new Date(1e3*i),t=new Date(1e3*t),format_options_inizio={day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"},format_options_fine={day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"},i.getFullYear()==e.getFullYear()&&e.getFullYear()==t.getFullYear()&&(format_options_inizio.year=void 0,format_options_fine.year=void 0),i.getMonth()==t.getMonth()&&i.getDay()==t.getDay()&&(format_options_fine.day=void 0,format_options_fine.month=void 0),i.toLocaleString(Intl.NumberFormat().resolvedOptions().locale,format_options_inizio)+" - "+t.toLocaleString(Intl.NumberFormat().resolvedOptions().locale,format_options_fine))}function format_evento_to_html(i,t,e,o,n,a){return data=format_date(o,n),e=e?"urgente":"",ui_evento_html_template.replace("{id}",i).replace("{urgente}",e).replace("{testo}",a).replace("{data}",data)}function add_evento_to_ui_list(i,t,e,o,n,a){i=format_evento_to_html(i,t,e,o,n,a);ui_eventi_lista.innerHTML+=i}function ui_modifica_evento(){mostra_modifica_evento(parseInt(ui_context_menu.dataset.id)),ui_context_menu.closingcallback()}function refresh_eventi(){if(ordina_eventi(),ui_eventi_lista.innerHTML="",eventi.forEach(i=>{add_evento_to_ui_list(i.id,i.pubblicato,i.urgente,i.data_ora_inizio,i.data_ora_fine,i.testo)}),eventi_write)for(const t of document.getElementsByClassName("evento"))t.oncontextmenu=i=>{mostra_context_menu_evento(i,t)}}function ordina_eventi(){eventi.sort((i,t)=>i.urgente&&!t.urgente?-1:!i.urgente&&t.urgente?1:(!i.urgente||!t.urgente)&&(i.urgente||t.urgente)?void 0:i.data_ora_inizio-t.data_ora_inizio)}const ui_notizia_html_template=`
<li>
<div class="notizia {futura}" data-id={id} tabindex="0">
    <div class="notizia-testo">{testo}</div>
</div>
</li>`,ui_notizie_container=document.getElementById("notizie-container"),ui_notizie_lista=document.getElementById("notizie-lista");function format_notizia_to_html(i,t,e,o){t=1e3*t>new Date?"futura":"";return ui_notizia_html_template.replace("{id}",i).replace("{futura}",t).replace("{testo}",o)}function add_notizia_to_ui_list(i,t,e,o){i=format_notizia_to_html(i,t,e,o);ui_notizie_lista.innerHTML+=i}function ui_modifica_notizia(){mostra_modifica_notizia(parseInt(ui_context_menu.dataset.id)),ui_context_menu.closingcallback()}function refresh_notizie(){if(ui_notizie_lista.innerHTML="",notizie.forEach(i=>{add_notizia_to_ui_list(i.id,i.data_inizio,i.data_fine,i.testo)}),notizie_write)for(const t of document.getElementsByClassName("notizia"))t.oncontextmenu=i=>{mostra_context_menu_notizia(i,t)}}const ui_sostituzione_html_template=`<div class="sostituzione {pubblicato}" data-id={id} tabindex="0">
  <div class="sostituzione-data">
    <span>{data}</span>
  </div>
  <div class="sostituzione-data sostituzione-ora">
    <span>{ora}</span>
  </div>
  <div class="sostituzione-data sostituzione-classe">
    <span>{nome_classe}</span>
  </div>
  <div class="sostituzione-data sostituzione-aula">
    <span>{numero_aula}</span>
  </div>
  <div class="sostituzione-data sostituzione-docente">
    <span>{cognome_docente} {nome_docente}</span>
  </div>
  <div class="sostituzione-data sostituzione-note">
    <span>{note}</span>
  </div>
  {icona_pubblicato}
</div>`,ui_sostituzioni_lista=document.getElementById("sostituzioni-lista"),ui_sostituzioni_messaggio_informativo=document.getElementById("sostituzioni-messaggio-informativo");let sostituzioni_data_verso_ordinamento=1;async function format_sostituzione_to_html(i,t,e,o,n,a,s,_,u,l,r,d){return ora=null==s?null==n?"":n+" - "+a:1==s.length?s+"a ora":s,null==d&&(d=""),null==r&&(l=r=""),null==u&&(u=""),null==_&&(_=""),icona_pubblicato=t?t="":(t="non-pubblicato",'<span class="material-symbols-rounded icon">visibility_off</span>'),o=new Date(1e3*o).toLocaleDateString(),ui_sostituzione_html_template.replace("{id}",i).replace("{pubblicato}",t).replace("{data}",o).replace("{ora}",ora).replace("{numero_aula}",_).replace("{nome_classe}",u).replace("{nome_docente}",l).replace("{cognome_docente}",r).replace("{note}",d).replace("{icona_pubblicato}",icona_pubblicato)}async function add_sostituzione_to_ui_list(i,t,e,o,n,a,s,_,u,l,r,d){i=format_sostituzione_to_html(i,t,e,o,n,a,s,_,u,l,r,d);ui_sostituzioni_lista.innerHTML+=i}async function refresh_sostituzioni(i){if(i=i||!1,ordina_sostituzioni(),i){ui_sostituzioni_lista.innerHTML="";i=sostituzioni_visualizzate.map(i=>format_sostituzione_to_html(i.id,i.pubblicato,i.cancellato,i.data,i.ora_inizio,i.ora_fine,i.numero_ora_predefinita,i.numero_aula,i.nome_classe,i.nome_docente,i.cognome_docente,i.note)),i=await Promise.all(i);if(ui_sostituzioni_lista.innerHTML=i.join(""),sostituzioni_write)for(const o of document.getElementsByClassName("sostituzione"))o.oncontextmenu=i=>{mostra_context_menu_sostituzione(i,o)}}else{const n=new Map;let i=0;var t=sostituzioni_visualizzate.map(i=>i.id);for(const a of document.getElementsByClassName("sostituzione")){var e=parseInt(a.dataset.id);t.includes(e)?(a.style.display="flex",n.set(e,{sostituzione:a,index:i}),i++):a.style.display="none"}t.forEach((i,t)=>{var{sostituzione:i,index:e}=n.get(i);t!==e&&(e=e<t?ui_sostituzioni_lista.children[t+1]:ui_sostituzioni_lista.children[t],ui_sostituzioni_lista.insertBefore(i,e))})}ui_sostituzioni_messaggio_informativo.style.display="none",0===sostituzioni_visualizzate.length&&(ui_sostituzioni_messaggio_informativo.innerHTML="<span>"+messaggio_nessuna_sostituzione+"</span>",ui_sostituzioni_messaggio_informativo.style.display="flex")}function ordina_sostituzioni(){sostituzioni_visualizzate.sort((i,t)=>res=0==(res=0==(res=compara_data(i,t)*sostituzioni_data_verso_ordinamento)?compara_ora_predefinita(t,i):res)?compara_docente(t,i):res),sostituzioni_filtro_ora.ordina||(sostituzioni_filtro_ora.ui_rimuovi_ordinamento(),sostituzioni_filtro_ora.verso_ordinamento=1),sostituzioni_filtro_classe.ordina||(sostituzioni_filtro_classe.ui_rimuovi_ordinamento(),sostituzioni_filtro_classe.verso_ordinamento=1),sostituzioni_filtro_aula.ordina||(sostituzioni_filtro_aula.ui_rimuovi_ordinamento(),sostituzioni_filtro_aula.verso_ordinamento=1),sostituzioni_filtro_docente.ordina||(sostituzioni_filtro_docente.ui_rimuovi_ordinamento(),sostituzioni_filtro_docente.verso_ordinamento=1),sostituzioni_filtro_ora.ordina&&sostituzioni_visualizzate.sort((i,t)=>compara_ora_predefinita(i,t)*sostituzioni_filtro_ora.verso_ordinamento),sostituzioni_filtro_classe.ordina&&sostituzioni_visualizzate.sort((i,t)=>compara_classe(i,t)*sostituzioni_filtro_classe.verso_ordinamento),sostituzioni_filtro_aula.ordina&&sostituzioni_visualizzate.sort((i,t)=>compara_aula(i,t)*sostituzioni_filtro_aula.verso_ordinamento),sostituzioni_filtro_docente.ordina&&sostituzioni_visualizzate.sort((i,t)=>compara_docente(i,t)*sostituzioni_filtro_docente.verso_ordinamento)}class Filtro extends Selezione{constructor({id:i,ordinamento:t,filtra_lista:e,render:o,select_on_keydown:n,autocomplete:a}){super({id:i,callback:sostituzioni_applica_filtri,filtra_lista:e,render:o,select_on_keydown:n,autocomplete:a}),this.ordinamento=t,this.ordinamento=void 0===this.ordinamento||this.ordinamento,this.ordinamento&&(this.ui_ordinamento=this.ui_container.getElementsByClassName("sostituzioni-ordinamento")[0],this.ui_ordinamento_frecciasu=this.ui_ordinamento.children[0],this.ui_ordinamento_frecciagiu=this.ui_ordinamento.children[1]),this.ordina=!1,this.verso_ordinamento=1,this.ordinamento&&(this.ui_ordinamento.onclick=i=>{this.verso_ordinamento*=-1,1===this.verso_ordinamento?(this.ui_ordinamento_frecciasu.classList.add("selected"),this.ui_ordinamento_frecciagiu.classList.remove("selected")):(this.ui_ordinamento_frecciasu.classList.remove("selected"),this.ui_ordinamento_frecciagiu.classList.add("selected")),this.ordina=!0,refresh_sostituzioni(),this.ordina=!1})}ui_rimuovi_ordinamento(){this.ui_ordinamento_frecciasu.classList.remove("selected"),this.ui_ordinamento_frecciagiu.classList.remove("selected")}}function sostituzioni_applica_filtri(){sostituzioni_visualizzate=sostituzioni,null!==sostituzioni_filtro_ora.selected&&(sostituzioni_visualizzate=sostituzioni_visualizzate.filter(i=>i.numero_ora_predefinita===sostituzioni_filtro_ora.selected)),null!==sostituzioni_filtro_classe.selected&&(sostituzioni_visualizzate=sostituzioni_visualizzate.filter(i=>null!==i.nome_classe&&i.nome_classe.toLowerCase().replace(/ /g,"")===sostituzioni_filtro_classe.selected.toLowerCase().replace(/ /g,""))),null!==sostituzioni_filtro_aula.selected&&(sostituzioni_visualizzate=sostituzioni_visualizzate.filter(i=>null!==i.numero_aula&&i.numero_aula.toLowerCase()===sostituzioni_filtro_aula.selected.toLowerCase())),null!==sostituzioni_filtro_docente.selected&&(sostituzioni_visualizzate=sostituzioni_visualizzate.filter(i=>null!==i.cognome_docente&&(i.cognome_docente+" "+i.nome_docente).toLowerCase().includes(sostituzioni_filtro_docente.selected.toLowerCase()))),null!==sostituzioni_filtro_note.selected&&(sostituzioni_visualizzate=sostituzioni_visualizzate.filter(i=>i.note.toLowerCase().includes(sostituzioni_filtro_note.selected.toLowerCase()))),refresh_sostituzioni()}let sostituzioni_filtro_ora=new Filtro({id:"sostituzioni-filtro-ora",filtra_lista:prendi_ora,render:i=>1==i.length?i+"a ora":i,autocomplete:!0}),sostituzioni_filtro_classe=new Filtro({id:"sostituzioni-filtro-classe",filtra_lista:prendi_nome}),sostituzioni_filtro_aula=new Filtro({id:"sostituzioni-filtro-aula",filtra_lista:prendi_numero}),sostituzioni_filtro_docente=new Filtro({id:"sostituzioni-filtro-docente",filtra_lista:prendi_cognome_nome}),sostituzioni_filtro_note=new Filtro({id:"sostituzioni-filtro-note",ordinamento:!1,select_on_keydown:!0}),sostituzioni_filtro_data_attivo="future";const ui_sostituzioni_filtro_data=document.getElementById("sostituzioni-filtro-data"),ui_sostituzioni_filtro_data_expandible=document.getElementById("sostituzioni-filtro-data-expandible"),ui_sostituzioni_filtro_data_oggi=document.getElementById("sostituzioni-filtro-data-oggi"),ui_sostituzioni_filtro_data_domani=document.getElementById("sostituzioni-filtro-data-domani"),ui_sostituzioni_filtro_data_future=document.getElementById("sostituzioni-filtro-data-future"),ui_sostituzioni_filtro_data_data=document.getElementById("sostituzioni-filtro-data-data"),ui_sostituzioni_filtro_data_mese=document.getElementById("sostituzioni-filtro-data-mese"),ui_sostituzioni_filtro_data_tutte=document.getElementById("sostituzioni-filtro-data-tutte");function sostituzioni_filtra_data(){switch(ui_sostituzioni_filtro_data_rimuovi_selected(),sostituzioni_filtro_data_attivo){case"oggi":(data_inizio=new Date).setHours(0,0,0,0),(data_fine=new Date).setHours(23,59,59,0),filtri={data_inizio:data_inizio.getTime()/1e3,data_fine:data_fine.getTime()/1e3},ui_sostituzioni_filtro_data_oggi.classList.add("selected");break;case"domani":(data_inizio=new Date).setDate(data_inizio.getDate()+1),data_inizio.setHours(0,0,0,0),(data_fine=new Date).setDate(data_inizio.getDate()),data_fine.setHours(23,59,59,0),filtri={data_inizio:data_inizio.getTime()/1e3,data_fine:data_fine.getTime()/1e3},ui_sostituzioni_filtro_data_domani.classList.add("selected");break;case"future":(data_inizio=new Date).setHours(0,0,0,0),filtri={data_inizio:data_inizio.getTime()/1e3,data_fine:null},ui_sostituzioni_filtro_data_future.classList.add("selected");break;case"data":if(null==(data_inizio=ui_sostituzioni_filtro_data_data.valueAsDate)||null==data_inizio)return;data_inizio.setHours(0,0,0,0),(data_fine=new Date(data_inizio.getTime())).setHours(23,59,59,0),filtri={data_inizio:data_inizio.getTime()/1e3,data_fine:data_fine.getTime()/1e3},ui_sostituzioni_filtro_data_data.classList.add("selected");break;case"mese":ui_sostituzioni_filtro_data_mese.value,ui_sostituzioni_filtro_data_mese.classList.add("selected");break;case"tutte":filtri={data_inizio:0},ui_sostituzioni_filtro_data_tutte.classList.add("selected");break;default:(data_inizio=new Date).setHours(0,0,0,0),filtri={data_inizio:data_inizio.getTime()/1e3,data_fine:null},ui_sostituzioni_filtro_data_future.classList.add("selected")}return filtri}function ui_sostituzioni_filtra_data(){ui_loading_sostituzioni(),s_richiedi_sostituzioni(filtri=sostituzioni_filtra_data())}function ui_sostituzioni_filtro_data_rimuovi_selected(){ui_sostituzioni_filtro_data_oggi.classList.remove("selected"),ui_sostituzioni_filtro_data_domani.classList.remove("selected"),ui_sostituzioni_filtro_data_future.classList.remove("selected"),ui_sostituzioni_filtro_data_data.classList.remove("selected"),ui_sostituzioni_filtro_data_mese.classList.remove("selected"),ui_sostituzioni_filtro_data_tutte.classList.remove("selected")}ui_sostituzioni_filtro_data.onfocus=i=>{ui_sostituzioni_filtro_data_expandible.classList.add("active")},ui_sostituzioni_filtro_data.onblur=i=>{i.relatedTarget&&i.relatedTarget.closest("#sostituzioni-filtro-data-expandible")?(ui_sostituzioni_filtro_data.focus(),i.preventDefault(),i.stopPropagation()):ui_sostituzioni_filtro_data_expandible.classList.remove("active")},ui_sostituzioni_filtro_data_oggi.onclick=i=>{sostituzioni_filtro_data_attivo="oggi",ui_sostituzioni_filtra_data()},ui_sostituzioni_filtro_data_domani.onclick=i=>{sostituzioni_filtro_data_attivo="domani",ui_sostituzioni_filtra_data()},ui_sostituzioni_filtro_data_future.onclick=i=>{sostituzioni_filtro_data_attivo="future",ui_sostituzioni_filtra_data()},ui_sostituzioni_filtro_data_data.onclick=ui_sostituzioni_filtro_data_data.onchange=i=>{sostituzioni_filtro_data_attivo="data",ui_sostituzioni_filtra_data()},ui_sostituzioni_filtro_data_mese.onclick=ui_sostituzioni_filtro_data_mese.onchange=i=>{sostituzioni_filtro_data_attivo="mese",ui_sostituzioni_filtra_data()},ui_sostituzioni_filtro_data_tutte.onclick=i=>{sostituzioni_filtro_data_attivo="tutte",ui_sostituzioni_filtra_data()},ui_sostituzioni_filtro_data_data.valueAsDate=new Date;const ui_gestione_dati=document.getElementById("gestione-dati-container"),ui_titolo_gestione_dati=document.getElementById("gestione-dati-titolo");function nascondi_gestione_dati(){ui_gestione_dati.classList.add("hidden"),ui_gestione_dati_sostituzione.classList.add("hidden"),ui_gestione_dati_evento.classList.add("hidden"),ui_gestione_dati_notizia.classList.add("hidden")}const ui_gestione_dati_sostituzione=document.getElementById("gestione-dati-sostituzione"),ui_pulsante_terziario_sostituzione=document.getElementById("pulsante-terziario-sostituzione"),ui_pulsante_secondario_sostituzione=document.getElementById("pulsante-secondario-sostituzione"),ui_pulsante_principale_sostituzione=document.getElementById("pulsante-primario-sostituzione"),gestione_dati_sostituzione_data=document.getElementById("gestione-dati-sostituzione-data"),gestione_dati_sostituzione_ora_inizio=document.getElementById("gestione-dati-sostituzione-ora-inizio"),gestione_dati_sostituzione_ora_fine=document.getElementById("gestione-dati-sostituzione-ora-fine"),gestione_dati_sostituzione_ora_predefinita=new Selezione({id:"gestione-dati-sostituzione-ora-predefinita",filtra_lista:prendi_ora,render:i=>1==i.length?i+"a ora":i,autocomplete:!0}),gestione_dati_sostituzione_docente=new Selezione({id:"gestione-dati-sostituzione-docente",filtra_lista:prendi_cognome_nome,autocomplete:!0}),gestione_dati_sostituzione_aula=new Selezione({id:"gestione-dati-sostituzione-aula",filtra_lista:prendi_numero,autocomplete:!0}),gestione_dati_sostituzione_note=new Selezione({id:"gestione-dati-sostituzione-note",filtra_lista:prendi_testo}),gestione_dati_sostituzione_classe=new Selezione({id:"gestione-dati-sostituzione-classe",callback:t=>{var i;!gestione_dati_sostituzione_aula.valore&&t&&0<(i=classi.find(i=>i.nome==t).aule_ospitanti).length&&(gestione_dati_sostituzione_aula.valore=i[0])},filtra_lista:prendi_nome,autocomplete:!0});function mostra_gestione_sostituzione(){gestione_dati_sostituzione_ora_predefinita.aggiorna(ore_predefinite),gestione_dati_sostituzione_note.aggiorna(note_standard),gestione_dati_sostituzione_docente.aggiorna(docenti),gestione_dati_sostituzione_classe.aggiorna(classi),gestione_dati_sostituzione_aula.aggiorna(aule),ui_gestione_dati.classList.remove("hidden"),ui_gestione_dati_sostituzione.classList.remove("hidden")}function mostra_nuova_sostituzione(){mostra_gestione_sostituzione(),gestione_dati_sostituzione_data.valueAsNumber=fix_date_to_input(new Date),gestione_dati_sostituzione_ora_predefinita.valore="",gestione_dati_sostituzione_ora_inizio.value="",gestione_dati_sostituzione_ora_fine.value="",gestione_dati_sostituzione_docente.valore="",gestione_dati_sostituzione_classe.valore="",gestione_dati_sostituzione_aula.valore="",gestione_dati_sostituzione_note.valore="",ui_titolo_gestione_dati.innerHTML="Inserimento Nuova Sostituzione",ui_pulsante_terziario_sostituzione.classList.remove("hidden"),ui_pulsante_terziario_sostituzione.innerHTML="Annulla",ui_pulsante_terziario_sostituzione.onclick=nascondi_gestione_dati,ui_pulsante_secondario_sostituzione.innerHTML="Inserisci senza pubblicare",ui_pulsante_secondario_sostituzione.onclick=()=>conferma_nuova_sostituzione(!1),ui_pulsante_principale_sostituzione.innerHTML="Pubblica",ui_pulsante_principale_sostituzione.onclick=()=>conferma_nuova_sostituzione(!0)}function conferma_nuova_sostituzione(i){s_nuova_sostituzione({pubblicato:i,data:data=fix_date_from_input(gestione_dati_sostituzione_data.valueAsNumber)/1e3,ora_predefinita:gestione_dati_sostituzione_ora_predefinita.valore,ora_inizio:gestione_dati_sostituzione_ora_inizio.value,ora_fine:gestione_dati_sostituzione_ora_fine.value,docente:gestione_dati_sostituzione_docente.valore,classe:gestione_dati_sostituzione_classe.valore,aula:gestione_dati_sostituzione_aula.valore,note:gestione_dati_sostituzione_note.valore}),nascondi_gestione_dati()}function mostra_modifica_sostituzione(t){var i=sostituzioni.find(i=>i.id===t);gestione_dati_sostituzione_data.valueAsNumber=fix_date_to_input(new Date(1e3*i.data)),gestione_dati_sostituzione_ora_predefinita.valore=i.numero_ora_predefinita,gestione_dati_sostituzione_ora_inizio.value=i.ora_inizio,gestione_dati_sostituzione_ora_fine.value=i.ora_fine,gestione_dati_sostituzione_classe.valore=i.nome_classe,gestione_dati_sostituzione_aula.valore=i.numero_aula,gestione_dati_sostituzione_note.valore=i.note,i.cognome_docente?gestione_dati_sostituzione_docente.valore=i.cognome_docente+" "+i.nome_docente:gestione_dati_sostituzione_docente.valore="",mostra_gestione_sostituzione(),ui_titolo_gestione_dati.innerHTML="Modifica Sostituzione",ui_pulsante_terziario_sostituzione.classList.add("hidden"),ui_pulsante_secondario_sostituzione.innerHTML="Annulla",ui_pulsante_secondario_sostituzione.onclick=()=>nascondi_gestione_dati(),ui_pulsante_principale_sostituzione.innerHTML="Applica",ui_pulsante_principale_sostituzione.onclick=()=>conferma_modifica_sostituzione(t)}function conferma_modifica_sostituzione(i){s_modifica_sostituzione(i,{data:data=fix_date_from_input(gestione_dati_sostituzione_data.valueAsNumber)/1e3,ora_predefinita:gestione_dati_sostituzione_ora_predefinita.valore,ora_inizio:gestione_dati_sostituzione_ora_inizio.value,ora_fine:gestione_dati_sostituzione_ora_fine.value,docente:gestione_dati_sostituzione_docente.valore,classe:gestione_dati_sostituzione_classe.valore,aula:gestione_dati_sostituzione_aula.valore,note:gestione_dati_sostituzione_note.valore}),nascondi_gestione_dati()}function mostra_duplica_sostituzione(t){var i=sostituzioni.find(i=>i.id===t);gestione_dati_sostituzione_data.valueAsNumber=fix_date_to_input(new Date(1e3*i.data)),gestione_dati_sostituzione_ora_predefinita.valore=i.numero_ora_predefinita,gestione_dati_sostituzione_ora_inizio.value=i.ora_inizio,gestione_dati_sostituzione_ora_fine.value=i.ora_fine,gestione_dati_sostituzione_classe.valore=i.nome_classe,gestione_dati_sostituzione_aula.valore=i.numero_aula,gestione_dati_sostituzione_note.valore=i.note,i.cognome_docente?gestione_dati_sostituzione_docente.valore=i.cognome_docente+" "+i.nome_docente:gestione_dati_sostituzione_docente.valore="",mostra_gestione_sostituzione(),ui_titolo_gestione_dati.innerHTML="Modifica Sostituzione Duplicata",ui_pulsante_terziario_sostituzione.classList.remove("hidden"),ui_pulsante_terziario_sostituzione.innerHTML="Annulla",ui_pulsante_terziario_sostituzione.onclick=nascondi_gestione_dati,ui_pulsante_secondario_sostituzione.innerHTML="Inserisci senza pubblicare",ui_pulsante_secondario_sostituzione.onclick=()=>conferma_nuova_sostituzione(!1),ui_pulsante_principale_sostituzione.innerHTML="Pubblica",ui_pulsante_principale_sostituzione.onclick=()=>conferma_nuova_sostituzione(!0)}function pubblica_sostituzione(i,t){s_modifica_sostituzione(i,{pubblicato:t=void 0===t||t})}const ui_gestione_dati_evento=document.getElementById("gestione-dati-evento"),ui_pulsante_principale_evento=document.getElementById("pulsante-principale-evento"),gestione_dati_evento_data_inizio=document.getElementById("gestione-dati-evento-data-inizio"),gestione_dati_evento_data_fine=document.getElementById("gestione-dati-evento-data-fine"),gestione_dati_evento_testo=document.getElementById("gestione-dati-evento-testo"),gestione_dati_evento_urgente=document.getElementById("gestione-dati-evento-urgente");function mostra_gestione_evento(){ui_gestione_dati.classList.remove("hidden"),ui_gestione_dati_evento.classList.remove("hidden")}function mostra_nuovo_evento(){mostra_gestione_evento(),(today=new Date).setHours(0,0,0,0),today=fix_date_to_input(today),gestione_dati_evento_data_inizio.valueAsNumber=today,gestione_dati_evento_data_fine.valueAsNumber=today,gestione_dati_evento_testo.value="",gestione_dati_evento_urgente.checked=!1,ui_titolo_gestione_dati.innerHTML="Inserimento Nuovo Evento",ui_pulsante_principale_evento.innerHTML="Pubblica",ui_pulsante_principale_evento.onclick=conferma_nuovo_evento}function conferma_nuovo_evento(){data_ora_inizio=fix_date_from_input(gestione_dati_evento_data_inizio.valueAsNumber)/1e3,data_ora_fine=fix_date_from_input(gestione_dati_evento_data_fine.valueAsNumber)/1e3,data_ora_inizio>=data_ora_fine||(s_nuovo_evento({data_ora_inizio:data_ora_inizio,data_ora_fine:data_ora_fine,testo:gestione_dati_evento_testo.value,urgente:gestione_dati_evento_urgente.checked}),nascondi_gestione_dati())}function mostra_modifica_evento(t){var i=eventi.find(i=>i.id===t);gestione_dati_evento_data_inizio.valueAsNumber=fix_date_to_input(new Date(1e3*i.data_ora_inizio)),gestione_dati_evento_data_fine.valueAsNumber=fix_date_to_input(new Date(1e3*i.data_ora_fine)),gestione_dati_evento_testo.value=i.testo,gestione_dati_evento_urgente.checked=i.urgente,mostra_gestione_evento(),ui_titolo_gestione_dati.innerHTML="Modifica Evento",ui_pulsante_principale_evento.innerHTML="Applica",ui_pulsante_principale_evento.onclick=()=>conferma_modifica_evento(t)}function conferma_modifica_evento(i){data_ora_inizio=fix_date_from_input(gestione_dati_evento_data_inizio.valueAsNumber)/1e3,data_ora_fine=fix_date_from_input(gestione_dati_evento_data_fine.valueAsNumber)/1e3,data_ora_inizio>=data_ora_fine||(s_modifica_evento(i,{data_ora_inizio:data_ora_inizio,data_ora_fine:data_ora_fine,testo:gestione_dati_evento_testo.value,urgente:gestione_dati_evento_urgente.checked}),nascondi_gestione_dati())}function mostra_duplica_evento(t){var i=eventi.find(i=>i.id===t);gestione_dati_evento_data_inizio.valueAsNumber=fix_date_to_input(new Date(1e3*i.data_ora_inizio)),gestione_dati_evento_data_fine.valueAsNumber=fix_date_to_input(new Date(1e3*i.data_ora_fine)),gestione_dati_evento_testo.value=i.testo,gestione_dati_evento_urgente.checked=i.urgente,mostra_gestione_evento(),ui_titolo_gestione_dati.innerHTML="Modifica Evento Duplicato",ui_pulsante_principale_evento.innerHTML="Pubblica",ui_pulsante_principale_evento.onclick=conferma_nuovo_evento}const ui_gestione_dati_notizia=document.getElementById("gestione-dati-notizia"),ui_pulsante_principale_notizia=document.getElementById("pulsante-principale-notizia"),gestione_dati_notizia_data_inizio=document.getElementById("gestione-dati-notizia-data-inizio"),gestione_dati_notizia_data_fine=document.getElementById("gestione-dati-notizia-data-fine"),gestione_dati_notizia_testo=document.getElementById("gestione-dati-notizia-testo");function mostra_gestione_notizia(){ui_gestione_dati.classList.remove("hidden"),ui_gestione_dati_notizia.classList.remove("hidden")}function mostra_nuova_notizia(){mostra_gestione_notizia(),(today=new Date).setHours(0,0,0,0),today=fix_date_to_input(today),gestione_dati_notizia_data_inizio.valueAsNumber=today,gestione_dati_notizia_data_fine.valueAsNumber=today,gestione_dati_notizia_testo.value="",ui_titolo_gestione_dati.innerHTML="Inserimento Nuova Notizia",ui_pulsante_principale_notizia.innerHTML="Pubblica",ui_pulsante_principale_notizia.onclick=()=>conferma_nuova_notizia(!0)}function conferma_nuova_notizia(){data_inizio=fix_date_from_input(gestione_dati_notizia_data_inizio.valueAsNumber)/1e3,data_fine=fix_date_from_input(gestione_dati_notizia_data_fine.valueAsNumber)/1e3,data_inizio>data_fine?notyf.error("La data di inizio non può essere anteriore a quella di fine!"):(s_nuova_notizia({data_inizio:data_inizio,data_fine:data_fine,testo:gestione_dati_notizia_testo.value}),nascondi_gestione_dati())}function mostra_modifica_notizia(t){var i=notizie.find(i=>i.id===t);gestione_dati_notizia_data_inizio.valueAsNumber=fix_date_to_input(new Date(1e3*i.data_inizio)),gestione_dati_notizia_data_fine.valueAsNumber=fix_date_to_input(new Date(1e3*i.data_fine)),gestione_dati_notizia_testo.value=i.testo,mostra_gestione_notizia(),ui_titolo_gestione_dati.innerHTML="Modifica Notizia",ui_pulsante_principale_notizia.innerHTML="Applica",ui_pulsante_principale_notizia.onclick=()=>conferma_modifica_notizia(t)}function conferma_modifica_notizia(i){data_inizio=fix_date_from_input(gestione_dati_notizia_data_inizio.valueAsNumber)/1e3,data_fine=fix_date_from_input(gestione_dati_notizia_data_fine.valueAsNumber)/1e3,data_inizio>data_fine||(s_modifica_notizia(i,{data_inizio:data_inizio,data_fine:data_fine,testo:gestione_dati_notizia_testo.value}),nascondi_gestione_dati())}const socket=io();function s_richiedi_sostituzioni(i){i&&(i.pubblicato=!1),socket.emit("richiesta sostituzioni",i)}function s_richiedi_eventi(i){socket.emit("richiesta eventi",i)}function s_richiedi_notizie(i){socket.emit("richiesta notizie",i)}function s_nuova_sostituzione(i){socket.emit("nuova sostituzione",i)}function s_elimina_sostituzione(i,t){socket.emit("elimina sostituzione",{id:i,mantieni_in_storico:t})}function s_modifica_sostituzione(i,t){socket.emit("modifica sostituzione",{id:i,data:t})}function s_nuovo_evento(i){socket.emit("nuovo evento",i)}function s_elimina_evento(i){socket.emit("elimina evento",{id:i})}function s_modifica_evento(i,t){socket.emit("modifica evento",{id:i,data:t})}function s_nuova_notizia(i){socket.emit("nuova notizia",i)}function s_elimina_notizia(i){socket.emit("elimina notizia",{id:i})}function s_modifica_notizia(i,t){socket.emit("modifica notizia",{id:i,data:t})}socket.on("lista eventi",i=>{eventi=i,refresh_eventi()}),socket.on("lista notizie",i=>{notizie=i,refresh_notizie()}),socket.on("lista sostituzioni",i=>{for(const t of sostituzioni=i)t.cognome_docente&&(t.cognome_docente=t.cognome_docente.toUpperCase());sostituzioni_visualizzate=sostituzioni,refresh_sostituzioni(!0)}),socket.on("lista ore predefinite",i=>{ore_predefinite=i,sostituzioni_filtro_ora.aggiorna(ore_predefinite)}),socket.on("lista note standard",i=>{note_standard=i}),socket.on("lista classi",i=>{classi=i,sostituzioni_filtro_classe.aggiorna(classi)}),socket.on("lista aule",i=>{aule=i,sostituzioni_filtro_aula.aggiorna(aule)}),socket.on("lista docenti",i=>{for(const t of docenti=i)t.cognome&&(t.cognome=t.cognome.toUpperCase());docenti.sort((i,t)=>i.cognome.localeCompare(t.cognome)||i.nome.localeCompare(t.nome)),sostituzioni_filtro_docente.aggiorna(docenti)}),socket.on("aggiornamento sostituzioni",()=>{s_richiedi_sostituzioni(filtri=sostituzioni_filtra_data())}),socket.on("aggiornamento eventi",()=>{s_richiedi_eventi()}),socket.on("aggiornamento notizie",()=>{s_richiedi_notizie()}),socket.on("unauthorized",()=>{notyf.error("Prego ricaricare la pagina.")}),socket.on("disconnect",()=>{notyf.error("Connessione persa, non sarà possibile ricevere aggiornamenti.")});